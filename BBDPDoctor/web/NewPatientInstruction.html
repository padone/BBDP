<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"> 
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>BBDP</title>
		<link rel="Shortcut Icon" type="image/x-icon" href="img/frame/icon.ico">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<link href="frame/metisMenu/metisMenu.css" rel="stylesheet">
		<script src="frame/metisMenu/metisMenu.js"></script>
		<link href="frame/sb-admin-2/sb-admin-2.css" rel="stylesheet">
		<script src="frame/sb-admin-2/sb-admin-2.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<!-- 醫生端框架 css -->
		<link href="css/doctorFrame.css" rel="stylesheet">
		<!-- HTML編輯器 -->
		<!-- Include external CSS. -->
		<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/codemirror.min.css">
		<!-- Include Editor style. -->
		<link href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.5.1/css/froala_editor.pkgd.min.css" rel="stylesheet" type="text/css" />
		<link href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.5.1/css/froala_style.min.css" rel="stylesheet" type="text/css" />
		<!-- Include external JS libs. -->
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/codemirror.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/mode/xml/xml.min.js"></script>
		<!-- Include Editor JS files. -->
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.5.1//js/froala_editor.pkgd.min.js"></script>
		<!-- languages -->
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.5.1/js/languages/zh_tw.js"></script>
		<style type="text/css">
			#phoneView video { 
				max-width:100%;
			}
			#phoneView img { 
				max-width:100%;
			}
			#phoneView iframe {
				max-width:100%;
			}
		</style>
	</head>
	<body>
		<div id="wrapper">
			<!-- prepend navbar in doctorFrame.js -->
			<div id="page-wrapper">
				<div class="row">
					<!-- 內容 -->
					<div class="col-md-12">
						<div class="row">
							<!-- 左邊灰框 -->
							<div class="col-md-4" style="margin-top: 3vh; margin-bottom: 3vh;">
								<div class="row">
									<div class="col-md-12">
										<button type="button" class="btn btn-default" onclick="location.href='NewPatientInstruction.html'" disabled>新增衛教資訊</button>
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<br />
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<div class="panel panel-default left-list" style="min-height: 73vh; max-height: 73vh;">
											<div class="panel-heading">
												<form>
													<!-- 左邊灰框上面的選單 -->
													<select class="form-control" id="type1" onChange="changeType1(this.selectedIndex);">
														<option value="all">衛教資訊分類</option>
													</select>
												</form>
											</div>
											<div class="panel-body" style="overflow-y: auto;">
												<div class="list-group" id="blueDiv">
													<!-- 左邊灰框下面的項目(動態產生) 
													<a href="EditPatientInstruction.html" class="list-group-item left-list-item patientInstruction">
														<h4 class="list-group-item-heading">巴金森氏病介紹</h4>
														<p class="list-group-item-text text-right">2017-01-05 20:30</p>
													</a>
													<a href="EditPatientInstruction.html" class="list-group-item left-list-item patientInstruction">
														<h4 class="list-group-item-heading">如何照顧失智家人</h4>
														<p class="list-group-item-text text-right">2017-01-03 17:45</p>
													</a>
													<a href="EditPatientInstruction.html" class="list-group-item left-list-item patientInstruction">
														<h4 class="list-group-item-heading">腦髓漸空（老年失智症）預防保健</h4>
														<p class="list-group-item-text text-right">2017-01-02 13:22</p>
													</a>-->
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-md-8" style="margin-top: 3vh; margin-bottom: 3vh;">
								<div class="row">
									<div class="col-md-9 col-sm-9 col-xs-9">
										<!-- 右邊灰框上面的標題輸入框 -->
										<input type="text" class="form-control editInput" id="title" placeholder="請輸入文章標題..." />
									</div>
									<div class="col-md-3 col-sm-3 col-xs-3">
										<!-- 右上角的按鈕 -->
										<div class="btn-group pull-right">
											<button type="button" class="btn btn-default" onclick="addInstruction()">發佈</button>
											<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
												<span class="caret"></span>
											</button>
											<ul class="dropdown-menu" role="menu">
												<li><a style="cursor: pointer;" onclick="changeHtmlEditor()">手機模式預覽</a></li>
											</ul>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<br />
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<!-- 右邊灰框 -->
										<div class="panel panel-default right-content" style="min-height: 73vh; max-height: 73vh;">
											<div class="panel-heading">
												<div class="row" style="margin-left: 0.5vw;">
													<h5><b>分類</b></h5>
												</div>
												<div class="row">
													<!-- 右邊上面的分類 -->
													<div class="col-md-4">
														<select class="form-control editSelect" id="type2" onChange="changeType2(this.selectedIndex)">
															<option value="all">衛教資訊分類</option>
															<!-- <option value="">巴金森氏症</option> -->
														</select>
													</div>
													<div class="col-md-1">
														<h5>或</h5>
													</div>
													<div class="col-md-4">
														<input type="text" class="form-control editInput" id="typeInput" placeholder="請輸入要新增的分類名稱..." />
													</div>
												</div>
												<div class="row" style="margin-left: 0.5vw;">
													<h5><b>顯示症狀</b></h5>
												</div>
												<!-- 右邊灰框上面的症狀 -->
												<div class="row">
													<div class="col-md-4">
														<select class="form-control editSelect" id="symptom" onChange="changeSymptom()">
															<option value="all">請選擇症狀</option>
															<!-- <option value="">巴金森氏症</option> -->
														</select>
													</div>
													<div class="col-md-1">
														<h5>或</h5>
													</div>
													<div class="col-md-4">
														<input type="text" class="form-control editInput" id="symptomInput" placeholder="請輸入要新增的症狀名稱..." />
													</div>
												</div>
											</div>
											<!-- 右邊下面的HTML編輯器 -->
											<div id="HtmlEditor" class="panel-body" style="overflow-y: auto;">
												<div id="froala-editor"></div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>		
				</div>
			</div>
		</div>
		<!-- Modal -->
		<div class="modal fade" id="F12Modal" role="dialog">
			<div class="modal-dialog" id="F12Frame" style = "width:36vh">
				<div class="modal-content">
					<div class="modal-header">
						<select class="form-control" style="width:80%;display:inline;" id="modalSize" onChange="changeModalSize()">					
							<option value="1">Galaxy S5</option>
							<option value="2">LG Optimus L70</option>
							<option value="3">iPhone 5</option>
							<option value="4">iPhone 6</option>
							<option value="5">iPhone 6 Plus</option>
							<option value="6">ipad</option>
						</select>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
					</div>
					<div class="modal-body">
						<div id = "phoneView" style="height:64vh;font-size:calc(36vh * 0.05));overflow:auto;">
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<!-- modalGenerator js -->
		<script src="js/modalGenerator.js"></script>
		
		<!-- 醫生端框架 js -->
		<script src="js/doctorFrame.js"></script>
		<!-- HTML編輯器 -->
		<script>
		/*
			var url = "PatientInstructionServlet";
			var froalaUrl = "InstructionFroalaServlet";
			var maxInstructionID = 0;

			//取得maxpatientInstructionID
			$(document).ready(function() {
				$.ajax({
					url : "PatientInstructionServlet",
					data : {
						state : "getMaxInstructionID"
					},
					dataType : "json",
					success : function(response) {
						maxInstructionID = response;
						froalaEdit();
					},
					error : function() {console.log("錯誤訊息");}
				});
			});
			
			function froalaEdit(){
				var height = $("div.right-content").height() - $(".right-content > .panel-heading").height() - 120 - 50;
			
				$(function() {
					$('div#froala-editor').froalaEditor({
						language: 'zh_tw',
						placeholderText: '請輸入文章內容...',
						height: height,
						//>= 1200px
						toolbarButtons: ['undo', 'redo', '|', 'fontFamily', '|', 'fontSize',  'color', '|', 'bold', 'italic', 'underline', 'strikeThrough', 'subscript', 'superscript', '-', '|', 'paragraphFormat', 'align', 'formatOL', 'formatUL', 'outdent', 'indent', '|', 'specialCharacters', 'insertHR', 'quote', 'insertLink', 'insertTable', 'insertImage', 'insertVideo', '|', 'selectAll', 'clearFormatting', '|', 'fullscreen', 'help'],
						//>= 992px
						toolbarButtonsMD: ['undo', 'redo', '|', 'fontFamily', '|', 'fontSize',  'color', '|', 'bold', 'italic', 'underline', 'strikeThrough', 'subscript', 'superscript', '|', 'paragraphFormat', 'align', 'formatOL', 'formatUL', 'outdent', 'indent', '|', 'specialCharacters', 'insertHR', 'quote', 'insertLink', 'insertTable', 'insertImage', 'insertVideo', '|', 'selectAll', 'clearFormatting', '|', 'fullscreen', 'help'],
						//>= 768px
						toolbarButtonsSM: ['undo', 'redo', '|', 'fontFamily', '|', 'fontSize',  'color', '|', 'bold', 'italic', 'underline', 'strikeThrough', 'subscript', 'superscript', '|', 'paragraphFormat', 'align', 'formatOL', 'formatUL', 'outdent', 'indent', '|', 'specialCharacters', 'insertHR', 'quote', 'insertLink', 'insertTable', 'insertImage', 'insertVideo', '|', 'selectAll', 'clearFormatting', '|', 'fullscreen', 'help'],
						//< 768px
						toolbarButtonsXS: ['undo', 'redo', '|', 'fontFamily', '|', 'fontSize',  'color', '|', 'bold', 'italic', 'underline', 'strikeThrough', 'subscript', 'superscript', '|', 'paragraphFormat', 'align', 'formatOL', 'formatUL', 'outdent', 'indent', '|', 'specialCharacters', 'insertHR', 'quote', 'insertLink', 'insertTable', 'insertImage', 'insertVideo', '|', 'selectAll', 'clearFormatting', '|', 'fullscreen', 'help'],
						fontFamilySelection: true,
						fontSizeSelection: true,
						fontSizeDefaultSelection: '30',
						fontSize: ['30', '36', '40', '48', '50', '55', '60', '72', '80', '84', '96', '100', '108', '120'],
						linkList: [{
							text: 'Google',
							href: 'http://google.com',
							target: '_blank',
							rel: 'nofollow'
						}],
						paragraphFormat: {
							N: 'Normal',
							H1: 'Heading 1',
							H2: 'Heading 2',
							H3: 'Heading 3',
							H4: 'Heading 4'
						},
						//圖片和影片上傳位置需要改
						imageUploadURL: froalaUrl,
						imageUploadParams: {state: "uploadImage",patientInstructionID: maxInstructionID},
						imageUploadMethod:"POST",
						imageMaxSize: 5 * 1024 * 1024,
						imageAllowedTypes: ['jpeg', 'jpg', 'png'],
						
						//設置視頻上傳參數。
				        videoUploadURL: froalaUrl,
				        videoUploadParams: { state: "uploadVideo",patientInstructionID: maxInstructionID},
				        videoUploadMethod: 'POST',
				        videoMaxSize: 50 * 1024 * 1024,
				        videoAllowedTypes: [ 'webm' ,'mp4' ,'ogg' ] 	 //允許上傳MP4，WEBM和OGG
					})
					//*********************************image*********************************
					.on('froalaEditor.image.beforeUpload', function (e, editor, images) {
						// Return false if you want to stop the image upload.//事件在開始上傳請求之前觸發，可用於更改上傳參數或取消操作
					})
					.on('froalaEditor.image.uploaded', function (e, editor, response) {
						// Image was uploaded to the server.//在成功的圖像上傳請求後，但在編輯器中插入圖像之前觸發事件
					})
					.on('froalaEditor.image.inserted', function (e, editor, $img, response) {
						// Image was inserted in the editor.//將圖像插入編輯器後觸發事件
					})
					.on('froalaEditor.image.replaced', function (e, editor, $img, response) {
						// Image was replaced in the editor.//將圖像替換為編輯器後觸發事件
					})
					.on('froalaEditor.image.error', function (e, editor, error, response) {
						if (error.code == 1) { console.log("Bad link."); }
			       		else if (error.code == 2) { console.log("No link in upload response."); }
						else if (error.code == 3) { console.log("Error during image upload."); }
						else if (error.code == 4) { console.log("Parsing response failed."); }
						else if (error.code == 5) { console.log("Image too text-large."); }
						else if (error.code == 6) { console.log("Invalid image type."); }
						else if (error.code == 7) { console.log("Image can be uploaded only to same domain in IE 8 and IE 9."); }
						// Response contains the original server response to the request if available.
					})
					.on('froalaEditor.image.removed', function (e, editor, $img) {
						deleteImage(e, editor, $img);	//刪除image
					})
					//*********************************vedio*********************************
					.on('froalaEditor.video.beforeUpload', function (e, editor, videos) {
						// Return false if you want to stop the video upload.//事件在開始上傳請求之前觸發，可用於更改上傳參數或取消操作
						console.log("beforeUpload");
					})
					.on('froalaEditor.video.uploaded', function (e, editor, response) {
						// Video was uploaded to the server.//事件在成功的視頻上傳請求之後，但在編輯器中插入視頻之前觸發
						console.log("uploaded");
					})
					.on('froalaEditor.video.inserted', function (e, editor, $video) {
						console.log("inserted");
					})
					.on('froalaEditor.video.replaced', function (e, editor, $img, response) {
						// Video was replaced in the editor.//將視頻替換為編輯器後觸發事件
						console.log("replaced");
					})
					.on('froalaEditor.video.beforeRemove', function (e, editor, $video) {
						console.log("beforeRemove");
						console.log("$video.attr('src') : " + $video.attr('src'));
					})
					.on('froalaEditor.video.removed', function (e, editor, $video) {
						console.log("removed");
						//deleteVideo(e, editor, $video);	//刪除video
						console.log("刪除video");
						console.log("$video.attr('src') : " + $video.attr('src'));
						$.ajax({
							method: 'POST',						
					        url: froalaUrl,		
					        data: {								
					      	  state: "deleteVideo",
					      	  src: $video.attr('src')
					        }
					    })
					    .done (function (data) {
					  	  console.log ('Vedio was deleted');
					    })
					    .fail (function (err) {
					  	  console.log ('Vedio delete problem: ' + JSON.stringify(err));
					    })
					});
				})
			}
			*/
				/*
					.on('froalaEditor.video.beforeUpload', function (e, editor, videos) {
						// Return false if you want to stop the video upload.//事件在開始上傳請求之前觸發，可用於更改上傳參數或取消操作
						console.log("beforeUpload");
					})
					.on('froalaEditor.video.uploaded', function (e, editor, response) {
						// Video was uploaded to the server.//事件在成功的視頻上傳請求之後，但在編輯器中插入視頻之前觸發
						console.log("uploaded");
					})
					.on('froalaEditor.video.inserted', function (e, editor, $img, response) {
						// Video was inserted in the editor.//將視頻插入編輯器後觸發事件
						console.log("inserted");
					})
					.on('froalaEditor.video.replaced', function (e, editor, $img, response) {
						// Video was replaced in the editor.//將視頻替換為編輯器後觸發事件
						console.log("replaced");
					})
					.on('froalaEditor.video.error', function (e, editor, error, response) {
						if (error.code == 1) { console.log("Bad link."); }
						else if (error.code == 2) { console.log("No link in upload response."); }
						else if (error.code == 3) { console.log("Error during video upload."); }
						else if (error.code == 4) { console.log("Parsing response failed."); }
				        else if (error.code == 5) { console.log("Video too text-large."); }
				        else if (error.code == 6) { console.log("Invalid video type."); }
				        else if (error.code == 7) { console.log("Video can be uploaded only to same domain in IE 8 and IE 9."); }
						// Response contains the original server response to the request if available.
					})
				*/
				/*
					.on('froalaEditor.video.codeError', function (e, editor, code) {
						console.log("codeError : " + code);
					})
					.on('froalaEditor.video.inserted', function (e, editor, $video) {
						console.log("inserted");
					})
					.on('froalaEditor.video.linkError', function (e, editor, link) {
						console.log("linkError : " + link);
					})
					.on('froalaEditor.video.beforeRemove', function (e, editor, $video) {
						console.log("beforeRemove");
						console.log("$video.attr('src') : " + $video.attr('src'));
					})
					.on('froalaEditor.video.removed', function (e, editor, $video) {
						console.log("removed");
						//deleteVideo(e, editor, $video);	//刪除video
						console.log("刪除video");
						console.log("$video.attr('src') : " + $video.attr('src'));
						$.ajax({
							method: 'POST',						
					        url: froalaUrl,		
					        data: {								
					      	  state: "deleteVideo",
					      	  src: $video.attr('src')
					        }
					    })
					    .done (function (data) {
					  	  console.log ('Vedio was deleted');
					    })
					    .fail (function (err) {
					  	  console.log ('Vedio delete problem: ' + JSON.stringify(err));
					    })
					});
				
				
				*/
			
		</script>
		<!-- 計算高度 -->
		<script>
			//左邊灰框的panel-body高度
			$(".left-list > .panel-body").css("min-height", "60vh");
			$(".left-list > .panel-body").css("max-height", "60vh");
		</script>
		
		<script src="js/newPatientInstruction.js"></script>		<!-- newPatientInstruction.js-->
		<script src="js/patientInstruction.js"></script>		<!-- patientInstruction.js-->
		
	</body>
</html>